name: Update Dashboard README

on:
  workflow_dispatch: # ×”×¤×¢×œ×” ×™×“× ×™×ª
  push:
    branches:
      - main
    paths:
      - 'manual_links.json' # ×ž×ª×¢×“×›×Ÿ ×¨×§ ×›×©×”×©×™× ×•×™ ××•×©×¨ ×•×ž×•×–×’ ×œ-main

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Calculate Stats and Generate README
        run: |
          # ×—×™×©×•×‘ ×›×ž×•×ª ×”×©×™×¨×™× ×”×›×•×œ×œ×ª ×ž×”-JSON ×œ×¡×˜×˜×™×¡×˜×™×§×” ×‘-README
          SONG_COUNT=$(jq '[.[] | length] | add' manual_links.json)
          CAT_COUNT=$(jq 'keys | length' manual_links.json)
          
          echo "# ðŸŽµ ×“×©×‘×•×¨×“ ×”×’× × ×ª ×”×ž×§×¦×•×¢×™ | Highlights Hub" > README.md
          echo "" >> README.md
          echo "[![Site Status](https://img.shields.io/website?url=https%3A%2F%2Falmog787.github.io%2Fhighlights-hub%2F&logo=googlechrome&logoColor=white)](https://almog787.github.io/highlights-hub/)" >> README.md
          echo "![GitHub last commit](https://img.shields.io/github/last-commit/Almog787/highlights-hub?color=blue)" >> README.md
          echo "![Songs Count](https://img.shields.io/badge/Songs_in_Library-$SONG_COUNT-orange?logo=youtubemusic)" >> README.md
          echo "" >> README.md
          echo "## ðŸŒ ××•×“×•×ª ×”×¤×¨×•×™×§×˜" >> README.md
          echo "×ž×¨×›×– ×ž×“×™×” ×“×™×’×™×˜×œ×™ ×ž×ª×§×“× ×”×ž×•×ª×× ××™×©×™×ª ×œ×’× ×™ ×™×œ×“×™× (×’×™×œ××™ 0-4). ×”×ž×¢×¨×›×ª ×ž×¡×¤×§×ª ×—×•×•×™×™×ª ×¦×¤×™×™×” × ×§×™×™×” ×œ×œ× ×¤×¨×¡×•×ž×•×ª, ×ª×•×š ×“×’×© ×¢×œ ×¤×“×’×•×’×™×” ×ž×•×–×™×§×œ×™×ª ×•×ª× ×•×¢×ª×™×ª." >> README.md
          echo "" >> README.md
          echo "### ðŸš€ ××¨×›×™×˜×§×˜×•×¨×” ×ž×•×“×¨× ×™×ª (v3.0)" >> README.md
          echo "* **CMS ×ž×‘×•×¡×¡ Google Sheets:** × ×™×”×•×œ ×”×ª×•×›×Ÿ ×ž×ª×‘×¦×¢ ×™×©×™×¨×•×ª ×ž×’×œ×™×•×Ÿ ××œ×§×˜×¨×•× ×™ ×—×›× ×œ×œ× ×¦×•×¨×š ×‘×›× ×™×¡×” ×œ×§×•×“." >> README.md
          echo "* **×ž× ×’× ×•×Ÿ ××™×©×•×¨ (QA):** ×›×œ ×¢×“×›×•×Ÿ ×ž×”×’×œ×™×•×Ÿ ×™×•×¦×¨ Pull Request ×”×ž×ž×ª×™×Ÿ ×œ×‘×“×™×§×” ×•××™×©×•×¨ ×œ×¤× ×™ ×”×¤×¨×¡×•×." >> README.md
          echo "* **××‘×˜×—×” ×ž×©×•×¤×¨×ª:** ×©×™×ž×•×© ×‘-Fine-grained Tokens ×ž×•×’×‘×œ×™× ×•×”×¨×©××•×ª Scope ×ž×™× ×™×ž×œ×™×•×ª." >> README.md
          echo "* **×ª××¨×™×š ×¢×‘×¨×™ ×ž×œ×:** ×ª×¦×•×’×ª ×ª××¨×™×š ×‘××•×ª×™×•×ª (×’×™×ž×˜×¨×™×”) ×ž×•×‘× ×™×ª ×‘×ž×¢×¨×›×ª." >> README.md
          echo "" >> README.md
          echo "## ðŸ“Š ×¡×˜×˜×™×¡×˜×™×§×ª ×ª×•×›×Ÿ" >> README.md
          echo "* **×¡×”\"×› ×©×™×¨×™× ×‘×ž×¢×¨×›×ª:** $SONG_COUNT" >> README.md
          echo "* **×§×˜×’×•×¨×™×•×ª ×¤×¢×™×œ×•×ª:** $CAT_COUNT" >> README.md
          echo "" >> README.md
          echo "## ðŸ”— ×§×™×©×•×¨×™× ×ž×”×™×¨×™×" >> README.md
          echo "| ×ž×©××‘ | ×§×™×©×•×¨ |" >> README.md
          echo "| :--- | :--- |" >> README.md
          echo "| ðŸ“º **×“×©×‘×•×¨×“ ×”×’× × ×ª** | [×›× ×™×¡×” ×œ×ž×¢×¨×›×ª](https://almog787.github.io/highlights-hub/) |" >> README.md
          echo "| ðŸ“‹ **× ×™×”×•×œ ×ª×•×›×Ÿ** | ×¢×¨×™×›×” ×“×¨×š Google Sheets ×”×ž×§×•×©×¨ |" >> README.md
          echo "" >> README.md
          echo "---" >> README.md
          echo "## ðŸ‘¨â€ðŸ’» ×ž×¤×ª×— ×”×ž×¢×¨×›×ª" >> README.md
          echo "[Almog787](https://github.com/Almog787)" >> README.md
          echo "" >> README.md
          echo "---" >> README.md
          echo "*×”-README ×¢×•×“×›×Ÿ ××•×˜×•×ž×˜×™×ª ×¢×œ ×™×“×™ GitHub Actions ×‘: $(date -u '+%d/%m/%Y %H:%M:%S') UTC*" >> README.md

      - name: Commit and Push Changes
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add README.md
          git commit -m "docs: sync README with new Sheets-CMS architecture" || exit 0
          git push
